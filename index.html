<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Submit a Tip</title>

  <style>
    :root {
      --primary: #1d4ed8;
      --primaryDark: #1e40af;
      --border: #e5e7eb;
      --bg: #f9fafb;
      --text: #111827;
      --muted: #6b7280;
      --danger: #b91c1c;
      --success: #166534;
      --radius: 14px;
    }

    * { box-sizing: border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      padding: 20px;
    }

    .container {
      max-width: 820px;
      margin: 0 auto;
    }

    header {
      margin: 6px 0 18px;
    }

    h1 {
      font-size: 34px;
      margin: 0 0 8px;
      letter-spacing: -0.3px;
    }

    .subtitle {
      font-size: 18px;
      color: var(--muted);
      margin: 0;
      line-height: 1.4;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      align-items: start;
    }

    @media (max-width: 900px) {
      .grid { grid-template-columns: 1fr; }
    }

    .card {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 22px;
    }

    label {
      display: block;
      font-size: 16px;
      font-weight: 700;
      margin: 0 0 8px;
    }

    .hint {
      font-size: 14px;
      color: var(--muted);
      margin: -2px 0 14px;
      line-height: 1.4;
    }

    input[type="text"], textarea {
      width: 100%;
      font-size: 18px;
      padding: 14px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fff;
      outline: none;
      margin: 0 0 16px;
    }

    input[type="text"]:focus, textarea:focus {
      border-color: rgba(29, 78, 216, 0.6);
      box-shadow: 0 0 0 4px rgba(29, 78, 216, 0.12);
    }

    textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.45;
    }

    .fileBox {
      border: 1px dashed #cbd5e1;
      border-radius: 14px;
      padding: 14px;
      background: #f8fafc;
      margin-bottom: 16px;
    }

    .fileRow {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
    }

    .fileName {
      font-size: 16px;
      color: var(--muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }

    .btnRow {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    button {
      border: none;
      border-radius: 12px;
      padding: 14px 14px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.04s ease, opacity 0.12s ease, background 0.12s ease;
    }
    button:active { transform: translateY(1px); }

    .primaryBtn {
      width: 100%;
      background: var(--primary);
      color: #fff;
    }
    .primaryBtn:hover { background: var(--primaryDark); }
    .primaryBtn:disabled {
      background: #93c5fd;
      cursor: not-allowed;
      opacity: 0.95;
    }

    .ghostBtn {
      background: #fff;
      border: 1px solid var(--border);
      color: var(--text);
      font-weight: 700;
      padding: 12px 14px;
      font-size: 16px;
    }

    .dangerBtn {
      background: #fff;
      border: 1px solid #fecaca;
      color: var(--danger);
      font-weight: 800;
      padding: 12px 14px;
      font-size: 16px;
    }

    /* Messages */
    .msg {
      display: none;
      margin: 14px 0 0;
      padding: 12px 12px;
      border-radius: 12px;
      font-size: 16px;
      line-height: 1.35;
    }
    .msg.error {
      display: block;
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: var(--danger);
    }
    .msg.success {
      display: block;
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      color: var(--success);
    }

    /* Preview */
    .previewTitle {
      font-size: 22px;
      margin: 0 0 10px;
      font-weight: 800;
      letter-spacing: -0.2px;
    }

    .previewBox {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      background: #f8fafc;
    }

    .media {
      width: 100%;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #e2e8f0;
      background: #fff;
      margin-bottom: 12px;
    }

    .media img, .media video {
      width: 100%;
      display: none;
      max-height: 420px;
      object-fit: cover;
    }

    .emptyState {
      padding: 18px;
      text-align: center;
      color: var(--muted);
      font-size: 16px;
      line-height: 1.4;
    }

    .pTitle {
      font-size: 20px;
      font-weight: 800;
      margin: 0 0 6px;
    }

    .pDesc {
      font-size: 16px;
      color: var(--muted);
      margin: 0;
      white-space: pre-wrap;
    }

    /* Hide the actual file input */
    input[type="file"] { display: none; }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>Submit a Tip</h1>
      <p class="subtitle">Upload a photo or video and describe what you saw. Mobile-friendly and easy to read.</p>
    </header>

    <div class="grid">
      <!-- Form -->
      <section class="card" aria-label="Tip form">
        <label for="title">Title</label>
        <div class="hint">Short and clear (example: “Broken light near school entrance”).</div>
        <input id="title" type="text" maxlength="80" placeholder="Enter a short title..." />

        <label for="desc">Description</label>
        <div class="hint">Add helpful context: location, time, and what happened.</div>
        <textarea id="desc" maxlength="800" placeholder="Write the details..."></textarea>

        <label>Upload Photo or Video</label>
        <div class="hint">Choose a photo or short video from your phone or computer.</div>

        <div class="fileBox">
          <div class="fileRow">
            <div class="fileName" id="fileName">No file selected</div>
            <div class="fileName" id="fileMeta"></div>
          </div>

          <div class="btnRow">
            <input id="file" type="file" accept="image/*,video/*" />
            <button class="ghostBtn" type="button" id="chooseBtn">Choose File</button>
            <button class="dangerBtn" type="button" id="clearBtn">Clear File</button>
          </div>
        </div>

        <div id="msg" class="msg"></div>
      </section>

      <!-- Preview -->
      <aside class="card" aria-label="Preview">
        <div class="previewTitle">Preview</div>

        <div class="previewBox">
          <div class="media">
            <img id="imgPreview" alt="Image preview" />
            <video id="videoPreview" controls playsinline></video>
            <div class="emptyState" id="emptyState">
              No upload yet. Choose a photo or video to see it here.
            </div>
          </div>

          <div class="pTitle" id="pTitle">Your title will appear here</div>
          <p class="pDesc" id="pDesc">Your description will appear here.</p>
        </div>

        <!-- Submit button is ONLY visible after a file is selected -->
        <button class="primaryBtn" id="submitBtn" type="button" disabled style="display:none;">
          Upload a file to submit
        </button>
      </aside>
    </div>
  </div>

  <script>
    const titleEl = document.getElementById("title");
    const descEl = document.getElementById("desc");
    const fileEl = document.getElementById("file");

    const chooseBtn = document.getElementById("chooseBtn");
    const clearBtn = document.getElementById("clearBtn");
    const submitBtn = document.getElementById("submitBtn");

    const fileNameEl = document.getElementById("fileName");
    const fileMetaEl = document.getElementById("fileMeta");

    const msgEl = document.getElementById("msg");

    const pTitle = document.getElementById("pTitle");
    const pDesc = document.getElementById("pDesc");

    const imgPreview = document.getElementById("imgPreview");
    const videoPreview = document.getElementById("videoPreview");
    const emptyState = document.getElementById("emptyState");

    let objectUrl = null;

    function formatBytes(bytes) {
      if (bytes === 0) return "0 B";
      const k = 1024;
      const sizes = ["B", "KB", "MB", "GB"];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      const val = bytes / Math.pow(k, i);
      return `${val.toFixed(i === 0 ? 0 : 1)} ${sizes[i]}`;
    }

    function showMsg(text, kind) {
      msgEl.className = "msg " + (kind === "success" ? "success" : "error");
      msgEl.textContent = text;
      msgEl.style.display = "block";
    }

    function clearMsg() {
      msgEl.className = "msg";
      msgEl.textContent = "";
      msgEl.style.display = "none";
    }

    function hasFile() {
      return fileEl.files && fileEl.files.length > 0;
    }

    function updateSubmitVisibility() {
      // Only show submit button after a file is selected
      submitBtn.style.display = hasFile() ? "block" : "none";
    }

    function updateButton() {
      updateSubmitVisibility();

      if (!hasFile()) {
        submitBtn.disabled = true;
        submitBtn.textContent = "Upload a file to submit";
        return;
      }
      if (!titleEl.value.trim() || !descEl.value.trim()) {
        submitBtn.disabled = true;
        submitBtn.textContent = "Add title + description to submit";
        return;
      }
      submitBtn.disabled = false;
      submitBtn.textContent = "Submit Tip";
    }

    function clearPreview() {
      if (objectUrl) URL.revokeObjectURL(objectUrl);
      objectUrl = null;

      imgPreview.style.display = "none";
      videoPreview.style.display = "none";
      videoPreview.pause();
      videoPreview.removeAttribute("src");
      imgPreview.removeAttribute("src");

      emptyState.style.display = "block";
    }

    function setPreview(file) {
      clearPreview();
      if (!file) return;

      objectUrl = URL.createObjectURL(file);
      emptyState.style.display = "none";

      if (file.type.startsWith("image/")) {
        imgPreview.src = objectUrl;
        imgPreview.style.display = "block";
      } else if (file.type.startsWith("video/")) {
        videoPreview.src = objectUrl;
        videoPreview.style.display = "block";
      } else {
        emptyState.style.display = "block";
        showMsg("Unsupported file type. Please upload an image or video.", "error");
      }
    }

    function setFileLine(file) {
      if (!file) {
        fileNameEl.textContent = "No file selected";
        fileMetaEl.textContent = "";
        return;
      }
      fileNameEl.textContent = file.name || "Selected file";
      fileMetaEl.textContent = `${file.type || "file"} • ${formatBytes(file.size)}`;
    }

    function resetFormAndUI() {
      titleEl.value = "";
      descEl.value = "";
      fileEl.value = "";

      pTitle.textContent = "Your title will appear here";
      pDesc.textContent = "Your description will appear here.";

      setFileLine(null);
      clearPreview();
      clearMsg();
      updateButton();
    }

    // Live preview for text
    titleEl.addEventListener("input", () => {
      pTitle.textContent = titleEl.value || "Your title will appear here";
      clearMsg();
      updateButton();
    });

    descEl.addEventListener("input", () => {
      pDesc.textContent = descEl.value || "Your description will appear here.";
      clearMsg();
      updateButton();
    });

    chooseBtn.addEventListener("click", () => fileEl.click());

    clearBtn.addEventListener("click", () => {
      fileEl.value = "";
      setFileLine(null);
      clearPreview();
      clearMsg();
      updateButton();
    });

    fileEl.addEventListener("change", () => {
      clearMsg();
      const f = fileEl.files && fileEl.files[0];
      setFileLine(f);
      setPreview(f);
      updateButton();
    });

    // Submit (demo front-end only)
    submitBtn.addEventListener("click", async () => {
      clearMsg();

      if (!hasFile()) {
        showMsg("No file uploaded. Please select a photo or video.", "error");
        updateButton();
        return;
      }

      if (!titleEl.value.trim() || !descEl.value.trim()) {
        showMsg("Please add a title and description before submitting.", "error");
        updateButton();
        return;
      }

      // ✅ THIS is where you'd upload to real storage (Azure/Firebase/etc).
      // Example later: await fetch("https://your-upload-endpoint", { method:"POST", body: formData })

      showMsg("Submitted (demo). Form cleared.", "success");
      setTimeout(() => resetFormAndUI(), 650);
    });

    // Initial
    updateButton();
  </script>
</body>
</html>
